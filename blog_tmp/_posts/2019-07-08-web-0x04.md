---
layout: post
current: post
cover: 'assets/images/waves.jpg'
navigation: True
title: web-0x04 Basic SQL Injection
date: 2019-07-08 10:18:00
tags: Posts
class: post-template
subclass: 'post tag-web'
author: Ppeuni
---


# 0x04 Basic SQL Injection

안녕하세요 Ppeuni입니다.

저의 첫 포스팅은 Basic SQL Injection으로 시작하겠습니다.


##### What is SQL Injection?

SQL Injection은 웹 애플리케이션에서 입력된 쿼리의 유효성을 검증하지 않아 발생하는 공격으로 <br>  
DB의 데이터 추출이나 인증우회, 시스템 명령 실행 등을 실행할 수 있는 공격입니다. 



- ** 환경 구성 ** <br>
	-Nginx 1.10.3<br>
	-Python Flask 1.0.3<br>
	-Mysql 5.7.26<br>


##### What kind of SQL injection is there?
Sql Injection을 수행하는 방법은 인증우회, Union Sql Injection, Blind Sql Injection 방식 등 다양하지만,<br>
이번 포스팅에서는 Blind Sql Injecion 방식을 다루도록 하겠습니다.<br>
Blind Sql Injecion은 특정 위치의 데이터베이스 내 정보를 하나씩 비교하면서 해당 데이터를 조회하는 쿼리가 참일 때와 거짓일 때 서버의 반응에 따라 데이터를 찾는 방법입니다.<br>

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_1.png" | relative_url }}'>
  <figcaption><center>-blind sql injection-  
  </center></figcaption>
</figure>
<br>

Blind SQL Injection을 하기 위해서는 몇 가지 필요한 준비물이 있습니다.<br>
특정 위치에 어떤 데이터를 뽑을 때 뭔가 확실한 데이터를 모아 놓은 장소가 있다면 어떨까요? <br>
Mysql의 Information_schema는 데이터베이스 안의 모든 데이터를 모은 데이터 사전입니다. <br>
이런 데이터 사전을 놓고 하나씩 데이터를 비교한다면 데이터 찾기가 훨~씬 편하지 않을까요?<br><br>

1. information_schema<br><br> 
위에서 잠깐 언급한 "데이터 사전", information_schema는 Mysql 에 존재하는 데이터베이스 입니다.<br>
몇 가지 예문을 통해 이 사전이 어떤 데이터를 가지고 있는지 알아봅시다.<br>
Mysql은 show databases 라는 명령어로 데이터베이스 목록을 조회할 수 있습니다.<br>
데이터 사전도 하나의 데이터베이스로 SELECT 문으로 내용을 조회할 수 있습니다.<br>
Select * from information_schema.schemata 는 show databases 와 동일한 결과를 얻을 수 있습니다.<br>

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_2.png" | relative_url }}'>
  <figcaption><center>-information_schema 데이터베이스 조회-  
  </center></figcaption>
</figure>
<br> 


Mysql의 show tables는 어떨까요? 마찬가지로 Select * from information_schema.tables 로 동일한 결과를 얻을 수 있습니다.<br>

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_3.png" | relative_url }}'>
  <figcaption><center>-information_schema 테이블 조회-  
  </center></figcaption>
</figure>
<br> 

만약 Sql injection 대상이 되는 데이터의 테이블 이름을 찾는다고 한다면 이곳에 있는 데이터와 비교하면 어떨까요?<br><br> 

2.limit,Substr<br><br> 
본격적으로 데이터 찾기가 어떻게 이루어 지는지 알아봅시다.<br> 
Blind Sql injection으로 데이터를 찾을 때 쿼리와 Mysql 내장 함수를 함께 사용하면 드라마틱한 결과를 얻을 수 있습니다.<br> 
이번 포스팅에는 가장 유용한 limit, substr 함수에 대해 알아보겠습니다. <br> 
limit 함수는 아래와 같이 SELECT 문으로 조회한 결과의 특정 행을 가져옵니다. <br> 

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_4.png" | relative_url }}'>
  <figcaption><center>-limit 함수를 이용해 특정 행 출력-  
  </center></figcaption>
</figure>
<br> 


substr 함수는 substr(데이터, 시작 위치, 글자 수) 와 같은 형식으로 두 번째 인자,<br> 
세 번째 인자로 데이터의 범위를 줄여줍니다. 이 두 함수를 쿼리와 함께 곁들이면 데이터를 완벽하게 찾을 수 있습니다! YEAH!<br> 

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_5.png" | relative_url }}'>
  <figcaption><center>-substr 함수를 이용해 특정 문자 출력-  
  </center></figcaption>
</figure>
<br> 


이 때까지 배운 방법으로 참 거짓을 구분해보겠습니다.<br> 
boarddb의 데이터베이스에는 board와 member 테이블이 있습니다.<br> 

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_6.png" | relative_url }}'>
  <figcaption><center>-boarddb의 테이블 조회-  
  </center></figcaption>
</figure>
<br>

제가 작성한 발퀄의 게시판은 아래와 같이 bbs_no 이라는 값을 Select * from board where bbs_no=%s 쿼리문에 동적으로 집어넣습니다!<br>
동적으로 값이 넘어가는 곳에 우리가 원하는 sql문을 붙여 요청하면 개발자가 의도하지 않은 쿼리문을 만들 수 있습니다.<br>

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_9.png" | relative_url }}'>
  <figcaption><center>-boarddb의 테이블 조회-  
  </center></figcaption>
</figure>
<br>



게시물번호에 and 연산자를 붙여 sql문을 요청합니다. <br>  
and 연산자는 두개의 조건이 True일 경우만 True를 반환해줍니다.<br>  
테이블 목록의 첫번째 행의 첫번째 글자가 a가 맞는지 확인했을 때 서버는 에러(False)를 반환해줍니다. <br>  
이것으로 봤을 때 첫번째 테이블의 첫번째 글자가 a가 아닌 것을 확인할 수 있습니다!<br>  

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_7.png" | relative_url }}'>
  <figcaption><center>-boarddb의 테이블 조회-  
  </center></figcaption>
</figure>
<br>  
 
 
이번에는 테이블 목록의 첫번째 행의 첫번째 글자가 b가 맞는지 확인합니다.<br>  
서버는 정상페이지(True)를 반환해줍니다! 이것으로 테이블의 첫번째 글자가 b인 것을 확인할 수 있습니다!<br>  

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_8.png" | relative_url }}'>
  <figcaption><center>-boarddb의 테이블 조회-  
  </center></figcaption>
</figure>
<br>  

##### Data Automation

아래는 데이터베이스를 추출하기 위한 테스트 자동화 코드입니다.<br>  

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_10.png" | relative_url }}'>
  <figcaption><center>-Sql Injection 자동화코드-  
  </center></figcaption>
</figure>
<br>  



자동화코드를 통해 데이터를 추출한 것을 확인했습니다!! <br>  

<figure>
  <img data-action="zoom" src='{{ "/assets/images/web/0x04_11.png" | relative_url }}'>
  <figcaption><center>-Sql Injection 자동화 코드 데이터 추출 결과-  
  </center></figcaption>
</figure>
<br>  



대응방안은 다음 포스팅인 Advanced Sql Injection 에서 함께 설명하겠습니다~<br> 
감사합니다<br> 
 